<html>
  <head>
    <title>Dynamic Histogram Equalization</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>

  <body>

    <div>
      <p>Upload image here...</p>
      <form id="dhe_form" onsubmit="return false;" method= "POST" enctype="multipart/form-data">
        <input id="file" type = "file" name = "file" />
        <input type = "submit"/>
      </form>
    </div>

    <p hidden id="message">Please wait... this can take a while. Page will refresh upon completion.</p>

    {% if output_image %}
    <div>
      <h2>Input Image:</h2>
      <img src="{{ url_for('send_image_file', filename=input_image) }}" alt="Input Image">
    </div>
    {% endif %}

    {% if input_image %}
    <div>
      <h2>Output Image:</h2>
      <img src="{{ url_for('send_image_file', filename=output_image) }}" alt="Output Image">
    </div>

    <div>
      <a href="{{ url_for('download_image_file', filename=output_image) }}" download="dhe">
        <button>Download</button>
      </a>
    </div>
    {% endif %}
    
    
    <script>
      $("#dhe_form").submit(function (){
        $("#message").show();
        var formData = new FormData(this);
        // jQuery.each(jQuery('#file')[0].files, function(i, file) {
        //   data.append('file-'+i, file);
        // });
        $.ajax({
          url: '/dhe_upload',
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
          method: 'POST',
          type: 'POST',
          success:function(formData){
            $("#message").text('Done! Redirecting now...');
            location.reload();
          }
        })
      })
    </script>
  </body>

</html>